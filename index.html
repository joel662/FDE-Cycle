<!DOCTYPE html>
<html>
  <head>
    <title>AR FDE Cycle</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
  </head>

  <body style="margin: 0; overflow: hidden;">
    <!-- 
      AR Scene Configuration:
      - detectionMode: mono_and_matrix (allows using both pattern and barcode markers)
      - matrixCodeType: 3x3 (required for barcode markers)
    -->
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">
      
      <!-- 
        Markers:
        1. "hiro" preset -> Fetch Stage (Torus Knot)
        2. "kanji" preset -> Decode Stage (Box)
        3. barcode ID 0 -> Execute Stage (Sphere)
      -->

      <!-- Marker 1: Fetch Stage (Hiro) -->
      <a-marker preset="hiro" id="marker-fetch">
        <a-torus-knot 
          radius="0.26" 
          radius-tubular="0.05" 
          position="0 0.5 0"
          material="color: #4CC3D9; metalness: 0.5; roughness: 0.2"
          animation="property: rotation; to: 0 360 0; loop: true; dur: 3000; easing: linear">
        </a-torus-knot>
        <a-text value="FETCH" position="0 1.2 0" align="center" color="#4CC3D9"></a-text>
      </a-marker>

      <!-- Marker 2: Decode Stage (Kanji) -->
      <a-marker preset="kanji" id="marker-decode">
        <a-box 
          position="0 0.5 0" 
          material="color: #EF2D5E; opacity: 0.8; transparent: true"
          animation="property: rotation; to: 360 360 0; loop: true; dur: 5000; easing: easeInOutSine"
          animation__scale="property: scale; to: 1.2 1.2 1.2; dir: alternate; loop: true; dur: 1000">
        </a-box>
        <a-text value="DECODE" position="0 1.2 0" align="center" color="#EF2D5E"></a-text>
      </a-marker>

      <!-- Marker 3: Execute Stage (Barcode ID 0) -->
      <a-marker type="barcode" value="0" id="marker-execute">
        <a-sphere 
          position="0 0.5 0" 
          radius="0.4" 
          material="color: #FFC65D; wireframe: true"
          animation="property: rotation; to: 0 360 360; loop: true; dur: 4000; easing: linear">
        </a-sphere>
        <a-text value="EXECUTE" position="0 1.2 0" align="center" color="#FFC65D"></a-text>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      // Log marker detection for debugging
      const markers = ['marker-fetch', 'marker-decode', 'marker-execute'];
      
      markers.forEach(id => {
        const marker = document.querySelector(`#${id}`);
        marker.addEventListener('markerFound', () => {
          console.log(`%c Marker Found: ${id.split('-')[1].toUpperCase()}`, 'background: #222; color: #bada55; font-size: 1.2em;');
        });
        marker.addEventListener('markerLost', () => {
          console.log(`Marker Lost: ${id}`);
        });
      });
    </script>
  </body>
</html>